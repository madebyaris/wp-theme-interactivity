---
description: "MCP tools integration: web_search for version checking and real-time info, understand_image for visual analysis, Context7 for documentation"
alwaysApply: false
---

# MCP Tools Integration

MCP tools provide capabilities ESSENTIAL for reliable code generation. **Version checking and verification are not optional.**

---

## Web Search Tool Priority

### Primary: Cursor's Native WebSearch

Always try Cursor's native `WebSearch` tool first - it's always available:

```
→ WebSearch(search_term="Next.js 15 stable version January 2026")
```

### Fallback: MiniMax MCP web_search

If MiniMax MCP is configured, you can also use:

```
→ user-MiniMax-web_search(query="Next.js 15 stable version January 2026")
```

### Decision Pattern

```
<think>
[WEB SEARCH TOOL SELECTION]

1. Use Cursor's native WebSearch (always available)
2. If MiniMax MCP is configured, can use user-MiniMax-web_search as alternative
3. Both work similarly - prefer native WebSearch for simplicity
</think>
```

---

## Context7 MCP - Optional Documentation Tool

Context7 provides up-to-date library documentation but **requires separate setup**.

### If Context7 is Available

```
→ user-context7-resolve-library-id(libraryName="react", query="hooks documentation")
→ user-context7-query-docs(libraryId="/facebook/react", query="useEffect cleanup")
```

### If Context7 is NOT Available (Fallback)

Use web search for documentation instead:

```
→ WebSearch(search_term="React 19 useEffect cleanup function documentation")
→ WebSearch(search_term="Next.js 15 App Router official documentation")
```

---

## Critical Workflow: Version Checking

### MANDATORY Before Using Any Package

Every time you need to use a package/library:

```
<think>
[VERSION CHECK REQUIRED]

Package: [package-name]
Current date: [get from context, e.g., January 2026]
Framework context: [what framework/project]

Step 1: Web search for current version (use WebSearch)
Step 2: If unclear, use Context7 (if available) or more web searches
Step 3: Verify compatibility with project
</think>
```

### Version Check Execution Pattern

```
// Step 1: Always include current month and year in search
→ WebSearch(search_term="react latest stable version January 2026")
→ WebSearch(search_term="next.js 15 vs 14 which stable January 2026")
→ WebSearch(search_term="tailwindcss npm latest version 2026")

// Step 2: If web search is inconclusive and Context7 available
→ user-context7-resolve-library-id(libraryName="react", query="installation")
→ user-context7-query-docs(libraryId="/facebook/react", query="installation")

// Step 2 Alternative: If Context7 NOT available
→ WebSearch(search_term="react 19 installation guide official docs")

// Step 3: Check compatibility
→ WebSearch(search_term="react 19 next.js 15 compatibility issues 2026")
```

### When to Check Versions

| Situation | Action |
|-----------|--------|
| New project creation | Check ALL major dependencies |
| Adding new package | Check package + peer dependencies |
| User mentions library | Verify current stable version |
| Build/runtime error | Check for version conflicts |
| Migration/upgrade | Check breaking changes |

---

## Tool Call Formatting

### CRITICAL: Proper JSON Format

When calling MiniMax MCP tools:

1. **Use proper JSON** - Arguments must be valid JSON strings
2. **Escape special characters** - Quotes, newlines, and backslashes must be escaped
3. **Don't include thinking blocks** - `<think>` content goes BEFORE the tool call
4. **Keep queries simple** - 3-5 keywords work best

**Correct format:**
```json
{
  "query": "React 19 hooks documentation [current month] [current year]"
}
```

**Incorrect (will cause error 400/2013):**
```json
{
  "query": "→ search for React 19 <think>need docs</think>"
}
```

---

## web_search Tool

### Description
Performs web searches similar to Google Search, returning structured results with titles, links, snippets, and dates.

### Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `query` | string | Yes | Search query (3-5 keywords + date recommended) |

### Best Practices

#### 0. EXTRACT CURRENT DATE FIRST (Issue #3)
Before ANY web search, extract the current date from context:

```
<think>
[DATE EXTRACTION - MANDATORY]
Source: user_info context or system date
Current Date: [EXTRACT ACTUAL DATE, e.g., "January 2026"]

This MUST be used in all searches. No templates. No placeholders.
</think>
```

#### 1. ALWAYS Include Current Date for Version Queries
```
✅ Good: "Next.js 15 stable release January 2026"
❌ Bad:  "Next.js latest version"

✅ Good: "shadcn/ui installation guide 2026"
❌ Bad:  "how to install shadcn"
```

#### 1.5. NEVER Use Template Placeholders (Issue #5)
```
❌ FORBIDDEN (literal in search - will not work):
   "Next.js {version} {date_year}"
   "React ${version} hooks"
   "[package] latest version [year]"
   "{framework} installation {month} {year}"
   "... [current month] [current year]"  ← if left as literal text

✅ CORRECT (use actual values from context, e.g., user_info date):
   "Next.js 15 stable February 2026"
   "React 19 hooks documentation"
   "shadcn-ui installation guide 2026"
```

#### 2. Include Version Numbers When Known
```
✅ Good: "TypeScript 5.3 satisfies operator examples"
❌ Bad:  "TypeScript new features"

✅ Good: "React 19 useFormStatus hook usage"
❌ Bad:  "React form hooks"
```

#### 3. Add Framework Context
```
✅ Good: "Chart.js container height issue Next.js app router [current year]"
❌ Bad:  "Chart.js not working"

✅ Good: "Tailwind CSS v4 migration from v3 [current month] [current year]"
❌ Bad:  "Tailwind upgrade"
```

#### 4. Reformulate if No Good Results
```
Original: "react server components streaming"
Retry:    "RSC streaming SSR Next.js 15 [current month] [current year]"

Original: "shadcn button not working"
Retry:    "shadcn/ui button component tailwind config error [current year]"
```

### Usage Patterns

#### Version Checking (MOST IMPORTANT)
```
<think>
User wants to create a Next.js app. I need to check current stable versions
before proceeding. Current date: [current month] [current year].
</think>

→ WebSearch(search_term="Next.js npm latest stable version [current month] [current year]")
→ WebSearch(search_term="React latest stable version [current month] [current year]")
→ WebSearch(search_term="create-next-app latest version [current month] [current year]")
```

#### CLI Tool Availability
```
<think>
Before manually creating files, I should check if there's a CLI tool
available for this task.
</think>

→ WebSearch(search_term="shadcn-ui CLI add components command [current year]")
→ WebSearch(search_term="next.js create-next-app options typescript tailwind [current year]")
```

#### Error Debugging
```
<think>
User has an error I don't recognize. Let me search for recent solutions.
</think>

→ WebSearch(search_term="Next.js 15 NEXT_REDIRECT error app router [current year]")
→ WebSearch(search_term="hydration mismatch error React 19 server components")
```

#### Breaking Changes Check
```
<think>
Before suggesting an upgrade, I should check for breaking changes.
</think>

→ WebSearch(search_term="Next.js 15 breaking changes from 14 migration guide")
→ WebSearch(search_term="React 19 breaking changes upgrade path [current year]")
```

---

## understand_image Tool

### Description
Analyzes images using a Vision Language Model (VLM) to extract information, describe content, and answer questions about visual elements.

### Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `prompt` | string | Yes | What to analyze or extract from the image |
| `image_source` | string | Yes | URL or file path to the image |

### Supported Formats
- ✅ JPEG / JPG
- ✅ PNG
- ✅ WebP
- ❌ PDF, GIF, PSD, SVG

### When to Use

**Use `understand_image` for:**
- Analyzing screenshots of UI issues (like infinite chart expansion)
- Reading error messages from images
- Understanding architecture diagrams
- Interpreting flowcharts or wireframes
- Extracting text from screenshots
- Debugging visual layout problems
- Understanding UI mockups before implementation

### Usage Patterns

#### Debugging Visual Bugs
```
<think>
User reports charts expanding infinitely. Let me analyze the screenshot
to understand the issue.
</think>

→ understand_image(
    prompt="Describe the layout issue. What CSS properties or container settings might be causing elements to expand beyond their intended size?",
    image_source="/path/to/screenshot.png"
  )
```

#### Verifying UI Implementation
```
<think>
I've implemented a component. Let me verify it renders correctly
by taking a screenshot and analyzing it.
</think>

→ browser_take_screenshot()
→ understand_image(
    prompt="Does this UI match the expected design? Are there any visual issues like overflow, misalignment, or incorrect spacing?",
    image_source="/path/to/screenshot.png"
  )
```

---

## Context7 MCP Integration (OPTIONAL)

Context7 provides up-to-date library documentation directly in your workflow.
**This is an optional MCP that requires separate setup.**

### Setup (Optional)
Add to `.cursor/mcp.json`:
```json
{
  "mcpServers": {
    "context7": {
      "command": "npx",
      "args": ["-y", "@upstash/context7-mcp"]
    }
  }
}
```

### Tools (If Configured)

#### 1. `user-context7-resolve-library-id`
Find the Context7-compatible library ID for any package.

```
→ user-context7-resolve-library-id(libraryName="next.js", query="routing documentation")
Returns: /vercel/next.js
```

#### 2. `user-context7-query-docs`
Fetch up-to-date documentation for a library.

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `libraryId` | string | Yes | Library ID (e.g., `/vercel/next.js`) |
| `query` | string | Yes | What you want to learn about |

### When to Use Context7 (If Available)

**Use Context7 when:**
- Web search didn't provide clear version/API information
- Need accurate function signatures and parameters
- Looking for official code examples
- Verifying API usage patterns

### Fallback When Context7 NOT Available

Use web search for documentation:
```
→ WebSearch(search_term="Next.js 15 App Router routing documentation")
→ WebSearch(search_term="React 19 useFormStatus hook API reference")
```

**Prefer web_search when:**
- Checking latest versions (Context7 may lag behind releases)
- Looking for community solutions or workarounds
- Searching for security advisories
- Comparing multiple libraries

### Fallback Pattern

```
<think>
I need to know the correct API for React 19's useActionState hook.

Step 1: Try web search first (most current)
Step 2: If unclear, use Context7 for official docs
</think>

// Step 1: Web search
→ WebSearch(search_term="React 19 useActionState hook API signature [current month] [current year]")

// If result is unclear:
// Step 2: Context7
→ resolve-library-id(libraryName="react")
→ get-library-docs(
    context7CompatibleLibraryID="/facebook/react",
    topic="useActionState",
    mode="code"
  )
```

---

## Tool Chaining Patterns

### Pattern 1: Version Check → CLI → Verify

```
// 1. Check versions
→ WebSearch(search_term="create-next-app latest version options [current month] [current year]")

// 2. Use CLI with verified version
→ Shell(command="npx create-next-app@latest my-app --typescript --tailwind --app", description="Create Next.js app")

// 3. Verify it works
→ Shell(command="cd my-app && npm run build", description="Build to verify")
```

### Pattern 2: Error Screenshot → Analysis → Fix

```
// 1. Analyze the error screenshot
→ understand_image(
    prompt="What error is shown? Extract the full error message and stack trace.",
    image_source="/path/to/error.png"
  )

// 2. Search for solution
→ WebSearch(search_term="[extracted error message] solution [current year]")

// 3. Apply fix and verify
→ StrReplace(path="...", old_string="...", new_string="...")
→ Shell(command="npm run build", description="Verify fix")
```

### Pattern 3: Documentation → Implementation → Test

```
// 1. Get documentation
→ WebSearch(search_term="shadcn-ui data table example [current month] [current year]")
→ user-context7-query-docs(
    libraryId="/shadcn/ui",
    query="data-table implementation"
  )

// 2. Implement using CLI if available
→ Shell(command="npx shadcn-ui@latest add table", description="Add shadcn table")

// 3. Test in browser
→ browser_navigate(url="http://localhost:3000")
→ browser_snapshot()
```

### Pattern 4: New Library → Version + Compatibility Check

```
// 1. Check latest version
→ WebSearch(search_term="zod npm latest version [current month] [current year]")

// 2. Check compatibility with existing stack
→ WebSearch(search_term="zod react-hook-form compatibility [current year]")
→ WebSearch(search_term="zod TypeScript 5 support")

// 3. Get installation docs (if Context7 available)
→ user-context7-query-docs(
    libraryId="/colinhacks/zod",
    query="installation guide"
  )

// 4. Install with verified version
→ Shell(command="npm install zod@latest", description="Install zod")
```

---

## Error Handling

### API Error 400/2013: Invalid Function Arguments

**Causes:**
- Unescaped special characters in strings
- Including `<think>` blocks inside arguments
- Malformed JSON structure

**Solution:**
- Keep arguments simple and clean
- Use only plain text in query/prompt parameters
- Do all reasoning in `<think>` blocks BEFORE the tool call

### web_search Errors

| Error | Solution |
|-------|----------|
| No results | Try different keywords, add date |
| Rate limited | Wait and retry |
| Irrelevant results | Refine with version numbers/context |

### Context7 Errors

| Error | Solution |
|-------|----------|
| Library not found | Use web_search instead |
| No docs for topic | Try different topic or paginate |
| Outdated info | Verify with web_search |

---

## Proactive Tool Usage

Don't wait to be asked - use tools proactively:

### Version Checks
```
User: "I want to build a Next.js app"

<think>
User wants Next.js app. Before I start, I MUST check:
1. Current stable Next.js version
2. Compatible React version
3. Any recent breaking changes

This is not optional - I must verify before proceeding.
</think>

→ WebSearch(search_term="Next.js latest stable version [current month] [current year]")
```

### CLI Availability
```
User: "Add a button component"

<think>
Before manually creating a button component, I should check:
1. Is this a shadcn/ui project? 
2. Is there a CLI command to add it?
</think>

→ Read(path="package.json")  // Check for shadcn
→ WebSearch(search_term="shadcn-ui add button command [current year]")
```

### Compatibility Checks
```
User: "Install Prisma for my Next.js project"

<think>
Before installing, I should verify:
1. Current Prisma version
2. Compatibility with user's Next.js version
3. Any known issues
</think>

→ WebSearch(search_term="Prisma latest version [current month] [current year]")
→ WebSearch(search_term="Prisma Next.js 15 app router compatibility [current year]")
```

---

## Summary: The Essential Workflow

Every significant coding task should follow this pattern:

```
1. VERSION CHECK
   → WebSearch(search_term="[package] latest version [current month year]")

2. CLI CHECK
   → WebSearch(search_term="[task] CLI tool command [current year]")

3. COMPATIBILITY CHECK
   → WebSearch(search_term="[package A] [package B] compatibility [year]")

4. IMPLEMENTATION
   → Use CLI if available, otherwise manual with verified patterns

5. VERIFICATION
   → Shell(command="npm run build", description="Build project")
   → Browser tools to test UI
   → ReadLints(paths=["src/"]) to check for errors
```

This workflow prevents:
- Using outdated packages
- Manual work when CLIs exist
- Version conflicts
- Code that doesn't compile
- UI bugs that go unnoticed
